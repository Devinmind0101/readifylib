<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>Readify Library - Cloud-based Ebook Storage Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    body, html {
      font-family: 'Inter', sans-serif !important;
      background: linear-gradient(135deg, #05346b 0%, #0a2a4d 60%, #1e3a5c 100%) !important;
      color: #fff;
      min-height: 100vh;
      margin: 0;
    }
    .bg-blur-orange, .bg-blur-yellow {
      position: absolute;
      border-radius: 9999px;
      filter: blur(64px);
      pointer-events: none;
      z-index: 0;
      opacity: 0.25;
    }
    .bg-blur-orange {
      top: -6rem; left: -6rem; width: 18rem; height: 18rem; background: #f47920;
      filter: blur(64px);
      opacity: 0.25;
    }
    .bg-blur-yellow {
      bottom: -8rem; right: -8rem; width: 28rem; height: 28rem; background: #f4a020;
      filter: blur(80px);
      opacity: 0.18;
    }
    #mainContent {
      position: relative;
      z-index: 1;
      background: transparent !important;
    }
    .animate-in {
      animation: slideInFromTop 0.15s ease-out;
    }
    @keyframes slideInFromTop {
      from {opacity: 0; transform: translateY(-6px);}
      to {opacity: 1; transform: translateY(0);}
    }
    .backdrop-blur-sm {
      backdrop-filter: blur(4px);
    }
    .text-transparent {
      color: transparent;
    }
    .bg-clip-text {
      background-clip: text;
      -webkit-background-clip: text;
    }
    #userDropdown {
      background-color: rgba(255, 255, 255, 0.1) !important;
      backdrop-filter: blur(10px);
    }
    main.pt-16.pb-8.max-w-7xl.mx-auto.px-4.sm\:px-6.lg\:px-8 {
      padding: 0 !important;
      max-width: 100% !important;
      margin: 0 !important;
    }
    main.pt-16.pb-8.max-w-7xl.mx-auto.px-4.sm\:px-6.lg\:px-8 > section {
      max-width: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    section.mb-12.text-center.max-w-xl.mx-auto {
      position: relative;
      top: 30vh;
      transform: translateY(-30%);
      margin-bottom: 12rem;
      text-align: left;
      max-width: 100%;
      padding: 0 1rem;
    }
    .welcome-subtitle, .happy-reading {
      display: none;
    }
    #plusMenuContainer {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 64px;
    }
    #plusMenuButton {
      width: 48px;
      height: 48px;
      font-size: 2.5rem;
      font-weight: 700;
      border-radius: 0.5rem;
      background-image: linear-gradient(to right, #f47920, #f4a020);
      color: white;
      box-shadow: 0 4px 14px 0 rgba(244, 121, 32, 0.6);
      transition: background-image 0.3s ease;
      padding: 0;
      line-height: 1;
    }
    #plusMenuButton:hover {
      background-image: linear-gradient(to right, #f4a020, #f47920);
    }
    #plusMenuButton:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(244, 121, 32, 0.5);
    }
    nav[aria-label="Primary Navigation"] {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background-color: rgb(23, 55, 94);
      color: white;
      width: 16rem;
      position: fixed;
      top: 0; bottom: 0; left: 0;
      z-index: 40;
      overflow-y: auto;
      border-right: 1px solid rgba(255 255 255 / 0.2);
    }
    nav[aria-label="Primary Navigation"] > div:last-child {
      margin-top: auto;
      padding: 1rem;
      border-top: 1px solid rgba(255 255 255 / 0.2);
      color: #d1d5db;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: default;
      overflow: visible;
      max-width: 100%;
    }
    #userMenuButton > div {
      display: none !important;
    }
    #accountPopup {
      position: fixed;
      top: 4rem;
      right: 1rem;
      width: 260px;
      background-color: #0a2a4d;
      border-radius: 0.5rem;
      box-shadow: 0 10px 15px -3px rgba(244, 121, 32, 0.4), 0 4px 6px -2px rgba(244, 121, 32, 0.2);
      padding: 1rem 1.5rem;
      z-index: 60;
      font-size: 0.875rem;
      color: #f4a020;
      user-select: none;
      border: 1px solid #f47920;
      display: none;
    }
    #accountPopup .email {
      font-weight: 600;
      margin-bottom: 0.75rem;
      word-break: break-word;
      color: #f4a020;
    }
    #accountPopup button {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      font-weight: 700;
      cursor: pointer;
      border: none;
      text-align: center;
      background-color: transparent;
      color: #f4a020;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      box-shadow: none;
      transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out;
    }
    #accountPopup button:hover, #accountPopup button:focus {
      background-color: #f47920;
      color: white;
      outline: none;
      box-shadow: 0 4px 14px 0 rgba(244, 121, 32, 0.6);
    }
    #accountPopup .btn-premium {
      background-image: linear-gradient(to right, #f47920, #f4a020);
      color: white;
      font-weight: 700;
      padding: 0.75rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 14px 0 rgba(244, 121, 32, 0.6);
      margin-top: 0.5rem;
      transition: background-image 0.3s ease;
    }
    #accountPopup .btn-premium:hover {
      background-image: linear-gradient(to right, #f4a020, #f47920);
      outline: none;
    }
    .menu-button {
      opacity: 0;
      transition: opacity 0.15s ease-in-out;
      background-color: transparent;
      color: #f4a020;
      border-radius: 0.375rem;
      border: none;
      box-shadow: none;
      cursor: pointer;
    }
    .menu-button:hover, .menu-button:focus {
      color: white;
      background-color: #f47920;
      box-shadow: 0 4px 14px 0 rgba(244, 121, 32, 0.6);
      outline: none;
    }
    .group:hover .menu-button, .group:focus-within .menu-button {
      opacity: 1;
    }
    .popup-menu {
      position: absolute;
      top: 1.75rem;
      right: 0.25rem;
      background: #0a2a4d;
      border: 1px solid #f47920;
      border-radius: 0.5rem;
      box-shadow: 0 10px 15px -3px rgba(244, 121, 32, 0.4), 0 4px 6px -2px rgba(244, 121, 32, 0.2);
      width: 160px;
      z-index: 100;
      display: none;
      flex-direction: column;
      color: #f4a020;
      font-weight: 600;
    }
    .popup-menu button {
      padding: 0.5rem 1rem;
      text-align: left;
      font-size: 0.9rem;
      background: transparent;
      border: none;
      cursor: pointer;
      border-radius: 0.375rem;
      transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out;
    }
    .popup-menu button:hover, .popup-menu button:focus {
      background-color: #f47920;
      color: white;
      outline: none;
      box-shadow: 0 4px 14px 0 rgba(244, 121, 32, 0.6);
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(5, 52, 107, 0.85);
      z-index: 110;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #0a2a4d;
      border-radius: 1rem;
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
      padding: 2rem 2.5rem;
      box-shadow: 0 10px 15px -3px rgba(244, 121, 32, 0.4), 0 4px 6px -2px rgba(244, 121, 32, 0.2);
      position: relative;
      width: 360px;
      color: #f4a020;
      font-weight: 600;
      font-size: 1rem;
      border: 1px solid #f47920;
    }
    .modal-close-button {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: transparent;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #f4a020;
      transition: color 0.15s ease-in-out;
    }
    .modal-close-button:hover, .modal-close-button:focus {
      color: white;
      outline: none;
    }
    .rename-input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1.5px solid #f47920;
      border-radius: 0.75rem;
      font-size: 1rem;
      margin-bottom: 1.25rem;
      background-color: #05346b;
      color: #f4a020;
      font-weight: 600;
      transition: border-color 0.3s ease;
    }
    .rename-input:focus {
      outline: none;
      border-color: #f4a020;
      box-shadow: 0 0 8px 2px rgba(244, 121, 32, 0.7);
      background-color: #0a2a4d;
    }
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
    }
    .modal-button {
      padding: 0.5rem 1.25rem;
      border-radius: 0.75rem;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      font-size: 0.95rem;
      user-select: none;
    }
    .modal-button.cancel {
      background-color: transparent;
      color: #f4a020;
      border: 2px solid #f47920;
      box-shadow: none;
    }
    .modal-button.cancel:hover, .modal-button.cancel:focus {
      background-color: #f47920;
      color: white;
      outline: none;
      box-shadow: 0 4px 14px 0 rgba(244, 121, 32, 0.6);
    }
    .modal-button.confirm {
      background-image: linear-gradient(to right, #f47920, #f4a020);
      color: white;
      box-shadow: 0 4px 14px 0 rgba(244, 121, 32, 0.6);
    }
    .modal-button.confirm:hover, .modal-button.confirm:focus {
      background-image: linear-gradient(to right, #f4a020, #f47920);
      outline: none;
      box-shadow: 0 6px 20px 0 rgba(244, 121, 32, 0.8);
    }
    #welcomeSection {
      background-color: transparent !important;
      color: white;
      padding: 2rem 1rem;
      border-radius: 0.5rem;
      max-width: 100%;
      margin: 0 auto 3rem auto;
    }
    #welcomeSection h1 {
      color: white;
    }
    #welcomeSection p {
      color: #d1d5db;
    }
    nav[aria-label="Primary Navigation"] button,
    nav[aria-label="Primary Navigation"] span,
    nav[aria-label="Primary Navigation"] svg {
      color: #d1d5db;
    }
    nav[aria-label="Primary Navigation"] button:hover,
    nav[aria-label="Primary Navigation"] button:focus {
      color: #93c5fd;
      background-color: rgba(255 255 255 / 0.1);
    }
    nav[aria-label="Primary Navigation"] .bg-blue-100 {
      background-color: rgba(255 255 255 / 0.15) !important;
      color: #93c5fd !important;
      font-weight: 700 !important;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col relative">
  <div class="bg-blur-orange"></div>
  <div class="bg-blur-yellow"></div>
  <div class="flex flex-1 pt-14 min-h-0 relative z-10">
    <nav aria-label="Primary Navigation" class="flex flex-col">
      <div>
        <div class="flex items-center space-x-3 px-4 py-6 border-b border-gray-200">
          <div class="flex items-center justify-center w-8 h-8 bg-blue-600 rounded-md shrink-0">
            <svg class="lucide lucide-book-open w-5 h-5 text-white" data-lucide="book-open" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 7v14"></path>
              <path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path>
            </svg>
          </div>
          <div>
            <h1 class="text-lg font-semibold tracking-tight">Readify Library</h1>
            <p class="text-xs -mt-0.5">Cloud Ebook Storage</p>
          </div>
        </div>
        <div class="flex flex-col px-4 py-6 space-y-6 flex-1 overflow-y-auto relative">
          <div class="relative" id="plusMenuContainer">
            <button aria-controls="plusMenuDropdown" aria-expanded="false" aria-haspopup="true" class="flex items-center justify-center rounded-md text-lg font-bold hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-offset-1 focus:ring-[#f47920] shadow-sm" id="plusMenuButton" title="Add" type="button">+</button>
            <div aria-labelledby="plusMenuButton" aria-orientation="vertical" class="hidden absolute left-0 mt-1 w-40 rounded-md shadow-lg border border-[#f47920] py-1 bg-[#0a2a4d] z-50" id="plusMenuDropdown" role="menu">
              <button class="w-full text-left px-4 py-2 text-sm text-[#f4a020] hover:bg-[#f47920] hover:text-white transition-colors duration-150 flex items-center space-x-2 rounded-md" id="createFolderOption" role="menuitem" type="button">
                <svg class="lucide lucide-folder w-4 h-4 text-[#f4a020]" data-lucide="folder" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
                  <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                </svg>
                <span>Create Folder</span>
              </button>
              <button class="w-full text-left px-4 py-2 text-sm text-[#f4a020] hover:bg-[#f47920] hover:text-white transition-colors duration-150 flex items-center space-x-2 rounded-md" id="uploadFilesOption" role="menuitem" type="button">
                <svg class="lucide lucide-upload w-4 h-4 text-[#4ade80]" data-lucide="upload" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="17 8 12 3 7 8"></polyline>
                  <line x1="12" x2="12" y1="3" y2="15"></line>
                </svg>
                <span>Upload Files</span>
              </button>
            </div>
          </div>
          <ul class="flex flex-col space-y-1 mt-2">
            <li>
              <button class="w-full flex items-center space-x-3 px-3 py-2 rounded-md hover:bg-[#f47920] hover:text-white transition-colors duration-150 font-semibold" id="navRecentlyRead" type="button">
                <svg class="lucide lucide-clock w-5 h-5 text-[#f4a020]" data-lucide="clock" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <span>Recently Read</span>
              </button>
            </li>
            <li>
              <button class="w-full flex items-center space-x-3 px-3 py-2 rounded-md hover:bg-[#f47920] hover:text-white transition-colors duration-150 font-semibold" id="navLibrary" type="button">
                <svg class="lucide lucide-library w-5 h-5 text-[#f4a020]" data-lucide="library" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3 19a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z"></path>
                  <polyline points="3 7 12 13 21 7"></polyline>
                </svg>
                <span>My Library</span>
              </button>
            </li>
            <li class="relative">
              <button id="accountButton" class="w-full flex items-center space-x-3 px-3 py-2 rounded-md hover:bg-[#f47920] hover:text-white transition-colors duration-150 font-semibold" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="accountPopup">
                <svg class="fas fa-user-circle w-5 h-5 text-[#f4a020]" aria-hidden="true"></svg>
                <span>Account</span>
              </button>
              <div id="accountPopup" class="hidden fixed top-16 right-4 w-72 bg-[#0a2a4d] border border-[#f47920] rounded-xl shadow-xl z-50 p-6 flex flex-col gap-3" role="dialog" aria-modal="true" aria-label="Account options">
                <div class="flex items-center gap-3 mb-2">
                  <div class="flex items-center justify-center w-10 h-10 rounded-full bg-[#f47920] text-white text-xl font-bold">
                    <i class="fas fa-user-circle"></i>
                  </div>
                  <div>
                    <div id="accountEmail" class="font-semibold text-[#f4a020] truncate">user@email.com</div>
                    <div class="text-xs text-[#d1d5db]">Signed in with Google</div>
                  </div>
                </div>
                <div class="storage text-xs text-[#d1d5db] text-center mb-2" aria-live="polite" aria-atomic="true">
                  0 MB of 500 MB used
                </div>
                <button type="button" class="btn-change w-full py-2 rounded-lg font-semibold text-[#f4a020] border border-[#f47920] bg-transparent hover:bg-[#f47920] hover:text-white transition" id="changeAccountBtn" tabindex="0">
                  Change Account
                </button>
                <button type="button" class="btn-logout w-full py-2 rounded-lg font-semibold text-[#f4a020] border border-[#f47920] bg-transparent hover:bg-[#f47920] hover:text-white transition" id="logoutBtn" tabindex="0">
                  Logout
                </button>
                <button type="button" class="btn-premium w-full py-2 rounded-lg font-semibold bg-gradient-to-r from-[#f47920] to-[#f4a020] text-white shadow hover:from-[#f4a020] hover:to-[#f47920] transition" id="goPremiumBtn" tabindex="0">
                  Go Premium
                </button>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="border-t border-white/20 px-4 py-4">
        <div id="userMenuButton" class="truncate max-w-full" style="cursor: default;">john.doe@example.com</div>
      </div>
    </nav>
    <main class="flex-1 overflow-y-auto px-4 sm:px-6 lg:px-8 ml-64 min-h-0" id="mainContent">
      <section class="mb-12 max-w-full mx-auto" id="welcomeSection">
        <div class="flex items-center mb-3 space-x-2">
          <h1 class="text-3xl font-semibold">Welcome to Readify Library!</h1>
        </div>
        <p>Your personal cloud-based ebook collection awaits. Organize, upload, and enjoy your favorite books from anywhere, anytime.</p>
      </section>
      <section class="mb-12" id="recentlyReadSection">
        <div class="flex items-center mb-4 space-x-2 text-[#f4a020]">
          <svg class="lucide lucide-clock w-5 h-5" data-lucide="clock" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <h2 class="text-xl font-semibold">Recently Read Ebooks</h2>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 min-h-[6rem]" id="recentlyReadContainer"></div>
      </section>
      <section class="mb-12" id="librarySection">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-2 text-[#f4a020]">
            <svg class="lucide lucide-library w-5 h-5" data-lucide="library" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 19a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z"></path>
              <polyline points="3 7 12 13 21 7"></polyline>
            </svg>
            <h2 class="text-xl font-semibold">My Library</h2>
          </div>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 min-h-[8rem]" id="libraryItemsContainer"></div>
      </section>
      <section class="hidden" id="folderViewSection">
        <div class="flex items-center mb-4 space-x-3">
          <button class="flex items-center text-[#f47920] hover:text-[#f4a020] transition-colors duration-150 text-sm font-medium" id="backToLibraryBtn">
            <svg class="lucide lucide-arrow-left w-4 h-4 mr-1" data-lucide="arrow-left" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
              <line x1="19" x2="5" y1="12" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Back to Library
          </button>
          <h2 class="text-xl font-semibold" id="folderTitle"></h2>
        </div>
        <div class="space-y-5">
          <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 min-h-[8rem]" id="ebooksContainer"></div>
        </div>
      </section>
    </main>
  </div>

  <div id="uploadModal" class="hidden modal-overlay" role="dialog" aria-modal="true" aria-labelledby="uploadModalTitle">
    <div class="modal-content max-w-md w-full">
      <button class="modal-close-button" aria-label="Close upload dialog" id="uploadModalCloseBtn">&times;</button>
      <h3 id="uploadModalTitleLabel" class="text-lg font-semibold mb-4 text-[#f4a020]">Upload New Ebook</h3>
      <form id="uploadModalForm" class="space-y-5" novalidate>
        <div>
          <label for="uploadModalTitle" class="block text-sm font-semibold mb-1 text-[#f4a020]">Ebook Title *</label>
          <input type="text" id="uploadModalTitle" name="uploadModalTitle" required autocomplete="off" placeholder="Enter the title of your ebook" class="w-full px-3 py-2 border border-[#f47920] rounded-xl bg-[#05346b] text-[#f4a020] font-semibold focus:outline-none focus:ring-2 focus:ring-[#f47920] focus:border-[#f47920] transition" />
          <p id="uploadModalTitleError" class="text-red-600 text-xs mt-1 hidden">Please enter a title for the ebook.</p>
        </div>
        <div>
          <label for="uploadModalFile" class="block text-sm font-semibold mb-1 text-[#f4a020]">Ebook File *</label>
          <input type="file" id="uploadModalFile" name="uploadModalFile" accept=".pdf,.epub,.mobi,application/pdf" required class="w-full text-sm text-[#f4a020] file:mr-3 file:py-1 file:px-3 file:rounded-xl file:border-0 file:text-xs file:font-semibold file:bg-[#f47920] file:text-white hover:file:bg-[#f4a020] transition-colors duration-150" />
          <p id="uploadModalFileError" class="text-red-600 text-xs mt-1 hidden">Please select an ebook file to upload.</p>
          <p class="text-xs text-[#d1d5db] mt-1">Upload your ebook file (PDF, EPUB, MOBI)</p>
        </div>
        <div>
          <label for="uploadModalCover" class="block text-sm font-semibold mb-1 text-[#f4a020]">Cover Image (Optional)</label>
          <input type="file" id="uploadModalCover" name="uploadModalCover" accept="image/*" class="w-full text-sm text-[#f4a020] file:mr-3 file:py-1 file:px-3 file:rounded-xl file:border-0 file:text-xs file:font-semibold file:bg-[#f47920] file:text-white hover:file:bg-[#f4a020] transition-colors duration-150" />
          <p class="text-xs text-[#d1d5db] mt-1">Upload a cover image (JPG, PNG, GIF)</p>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1 text-[#f4a020]">Cover Preview</label>
          <div class="w-28 h-36 mx-auto bg-[#05346b] rounded-xl overflow-hidden border border-[#f47920] relative">
            <div id="uploadModalCoverPreview" class="w-full h-full flex flex-col items-center justify-center relative text-[#f4a020] select-none">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="image" class="lucide lucide-image w-7 h-7 mb-1"><rect height="14" rx="2" ry="2" width="18" x="3" y="3"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
              <span class="text-xs text-center px-2">No cover selected</span>
            </div>
          </div>
        </div>
        <div class="flex justify-end pt-3 border-t border-[#f47920]">
          <button type="submit" class="flex items-center space-x-1 px-5 py-2 rounded-xl font-semibold text-white shadow-lg focus:outline-none focus:ring-4 transition select-none bg-gradient-to-r from-[#f47920] to-[#f4a020] hover:from-[#f4a020] hover:to-[#f47920]">
            <svg class="lucide lucide-upload w-4 h-4" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" x2="12" y1="3" y2="15"></line>
            </svg>
            <span>Upload Ebook</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="hidden fixed inset-0 z-50 overflow-y-auto bg-[#05346bcc] flex items-center justify-center px-4" id="createFolderModal">
    <div class="modal-content max-w-md w-full p-6">
      <div class="flex items-center justify-between mb-5">
        <div class="flex items-center space-x-3">
          <div class="w-9 h-9 bg-[#f47920] rounded-xl flex items-center justify-center">
            <svg class="lucide lucide-folder w-5 h-5 text-white" data-lucide="folder" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-[#f4a020]">Create New Folder</h3>
        </div>
        <button aria-label="Close create folder modal" class="modal-close-button" id="closeModalBtn">&times;</button>
      </div>
      <form class="space-y-5" id="createFolderForm">
        <div>
          <label class="block text-sm font-semibold text-[#f4a020] mb-1" for="folderName">Folder Name</label>
          <input autocomplete="off" autofocus class="w-full px-3 py-2 border border-[#f47920] rounded-xl bg-[#05346b] text-[#f4a020] font-semibold focus:outline-none focus:ring-2 focus:ring-[#f47920] focus:border-[#f47920] transition" id="folderName" placeholder="Enter folder name..." required type="text" />
        </div>
        <div class="flex justify-end space-x-3">
          <button class="modal-button cancel" id="cancelBtn" type="button">Cancel</button>
          <button class="modal-button confirm" type="submit">
            <svg class="lucide lucide-plus w-4 h-4 mr-1 inline-block" data-lucide="plus" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
              <line x1="12" x2="12" y1="5" y2="19"></line>
              <line x1="5" x2="19" y1="12" y2="12"></line>
            </svg>
            <span>Create Folder</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <div id="renameModal" class="hidden modal-overlay" role="dialog" aria-modal="true" aria-labelledby="renameModalTitle">
    <div class="modal-content">
      <button class="modal-close-button" aria-label="Close rename dialog" id="renameModalCloseBtn">&times;</button>
      <h3 id="renameModalTitle" class="text-lg font-semibold mb-4 text-[#f4a020]">Rename Ebook</h3>
      <input type="text" id="renameInput" class="rename-input" aria-describedby="renameHelp" />
      <div class="modal-buttons">
        <button class="modal-button cancel" id="renameCancelBtn" type="button">Cancel</button>
        <button class="modal-button confirm" id="renameConfirmBtn" type="button">Rename</button>
      </div>
    </div>
  </div>

  <div id="folderRenameModal" class="hidden modal-overlay" role="dialog" aria-modal="true" aria-labelledby="folderRenameModalTitle">
    <div class="modal-content">
      <button class="modal-close-button" aria-label="Close folder rename dialog" id="folderRenameModalCloseBtn">&times;</button>
      <h3 id="folderRenameModalTitle" class="text-lg font-semibold mb-4 text-[#f4a020]">Rename Folder</h3>
      <input type="text" id="folderRenameInput" class="rename-input" aria-describedby="folderRenameHelp" />
      <div class="modal-buttons">
        <button class="modal-button cancel" id="folderRenameCancelBtn" type="button">Cancel</button>
        <button class="modal-button confirm" id="folderRenameConfirmBtn" type="button">Rename</button>
      </div>
    </div>
  </div>

  <div id="detailsModal" class="hidden modal-overlay" role="dialog" aria-modal="true" aria-labelledby="detailsModalTitle">
    <div class="modal-content">
      <button class="modal-close-button" aria-label="Close details dialog" id="detailsModalCloseBtn">&times;</button>
      <h3 id="detailsModalTitle" class="text-lg font-semibold mb-4 text-[#f4a020]">Ebook Details</h3>
      <div id="detailsContent" class="text-sm space-y-2 text-[#f4a020] font-semibold"></div>
      <div class="modal-buttons mt-4">
        <button class="modal-button confirm" id="detailsCloseBtn" type="button">Close</button>
      </div>
    </div>
  </div>

  <script>
    lucide.createIcons();

    let folders = [];
    let mainLibraryEbooks = [];
    let currentFolder = null;
    let currentFolderToRename = null;
    let currentEbook = null;
    let currentEbookFolder = null;

    const plusMenuButton = document.getElementById("plusMenuButton");
    const plusMenuDropdown = document.getElementById("plusMenuDropdown");
    const createFolderOption = document.getElementById("createFolderOption");
    const uploadFilesOption = document.getElementById("uploadFilesOption");
    const createFolderModal = document.getElementById("createFolderModal");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const createFolderForm = document.getElementById("createFolderForm");
    const folderNameInput = document.getElementById("folderName");
    const librarySection = document.getElementById("librarySection");
    const folderViewSection = document.getElementById("folderViewSection");
    const backToLibraryBtn = document.getElementById("backToLibraryBtn");
    const folderTitle = document.getElementById("folderTitle");
    const ebooksContainer = document.getElementById("ebooksContainer");
    const libraryItemsContainer = document.getElementById("libraryItemsContainer");
    const recentlyReadContainer = document.getElementById("recentlyReadContainer");
    const welcomeSection = document.getElementById("welcomeSection");
    const navLibrary = document.getElementById("navLibrary");
    const navRecentlyRead = document.getElementById("navRecentlyRead");
    const recentlyReadSection = document.getElementById("recentlyReadSection");
    const accountButton = document.getElementById("accountButton");
    const accountPopup = document.getElementById("accountPopup");
    const accountEmail = document.getElementById("accountEmail");
    const changeAccountBtn = document.getElementById("changeAccountBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const goPremiumBtn = document.getElementById("goPremiumBtn");
    const renameModal = document.getElementById("renameModal");
    const renameModalCloseBtn = document.getElementById("renameModalCloseBtn");
    const renameInput = document.getElementById("renameInput");
    const renameCancelBtn = document.getElementById("renameCancelBtn");
    const renameConfirmBtn = document.getElementById("renameConfirmBtn");
    const detailsModal = document.getElementById("detailsModal");
    const detailsModalCloseBtn = document.getElementById("detailsModalCloseBtn");
    const detailsCloseBtn = document.getElementById("detailsCloseBtn");
    const detailsContent = document.getElementById("detailsContent");
    const uploadModal = document.getElementById("uploadModal");
    const uploadModalCloseBtn = document.getElementById("uploadModalCloseBtn");
    const uploadModalForm = document.getElementById("uploadModalForm");
    const uploadModalTitle = document.getElementById("uploadModalTitle");
    const uploadModalFile = document.getElementById("uploadModalFile");
    const uploadModalCover = document.getElementById("uploadModalCover");
    const uploadModalCoverPreview = document.getElementById("uploadModalCoverPreview");
    const uploadModalTitleError = document.getElementById("uploadModalTitleError");
    const uploadModalFileError = document.getElementById("uploadModalFileError");
    const folderRenameModal = document.getElementById("folderRenameModal");
    const folderRenameModalCloseBtn = document.getElementById("folderRenameModalCloseBtn");
    const folderRenameInput = document.getElementById("folderRenameInput");
    const folderRenameCancelBtn = document.getElementById("folderRenameCancelBtn");
    const folderRenameConfirmBtn = document.getElementById("folderRenameConfirmBtn");

    plusMenuButton.addEventListener("click", togglePlusMenu);
    document.addEventListener("click", closePlusMenuOnClickOutside);
    createFolderOption.addEventListener("click", () => { closePlusMenu(); openCreateFolderModal(); });
    uploadFilesOption.addEventListener("click", () => { closePlusMenu(); openUploadModal(); });
    closeModalBtn.addEventListener("click", closeCreateFolderModal);
    cancelBtn.addEventListener("click", closeCreateFolderModal);
    createFolderForm.addEventListener("submit", handleCreateFolder);
    backToLibraryBtn.addEventListener("click", showLibraryView);
    navLibrary.addEventListener("click", () => { showLibraryView(); setActiveNav("library"); });
    navRecentlyRead.addEventListener("click", () => { showRecentlyReadView(); setActiveNav("recentlyRead"); });
    accountButton.addEventListener("click", (e) => { e.stopPropagation(); toggleAccountPopup(); });
    document.addEventListener("click", (e) => { if (!accountPopup.contains(e.target) && !accountButton.contains(e.target)) closeAccountPopup(); });
    changeAccountBtn.addEventListener("click", () => alert("Change Account clicked. Implement account update functionality."));
    logoutBtn.addEventListener("click", () => alert("Logout clicked. Implement logout functionality."));
    goPremiumBtn.addEventListener("click", () => alert("Go Premium clicked. Implement upgrade functionality."));
    renameModalCloseBtn.addEventListener("click", closeRenameModal);
    renameCancelBtn.addEventListener("click", closeRenameModal);
    renameConfirmBtn.addEventListener("click", confirmRename);
    renameInput.addEventListener("keydown", (e) => { if (e.key === "Enter") { e.preventDefault(); confirmRename(); } else if (e.key === "Escape") { e.preventDefault(); closeRenameModal(); } });
    folderRenameModalCloseBtn.addEventListener("click", closeFolderRenameModal);
    folderRenameCancelBtn.addEventListener("click", closeFolderRenameModal);
    folderRenameConfirmBtn.addEventListener("click", confirmFolderRename);
    folderRenameInput.addEventListener("keydown", (e) => { if (e.key === "Enter") { e.preventDefault(); confirmFolderRename(); } else if (e.key === "Escape") { e.preventDefault(); closeFolderRenameModal(); } });
    detailsModalCloseBtn.addEventListener("click", closeDetailsModal);
    detailsCloseBtn.addEventListener("click", closeDetailsModal);
    detailsModal.addEventListener("click", (e) => { if (e.target === detailsModal) closeDetailsModal(); });
    renameModal.addEventListener("click", (e) => { if (e.target === renameModal) closeRenameModal(); });
    uploadModalCloseBtn.addEventListener("click", closeUploadModal);
    uploadModalForm.addEventListener("submit", handleUploadModalSubmit);
    uploadModalCover.addEventListener("change", handleUploadModalCoverChange);
    document.addEventListener("click", (e) => {
      document.querySelectorAll(".popup-menu:not([style*='display: none'])").forEach(menu => {
        if (!menu.contains(e.target) && !menu.previousElementSibling.contains(e.target)) menu.style.display = "none";
      });
    });

    function toggleAccountPopup() {
      if (accountPopup.style.display === "flex") closeAccountPopup();
      else openAccountPopup();
    }
    function openAccountPopup() {
      accountPopup.style.display = "flex";
      accountButton.setAttribute("aria-expanded", "true");
    }
    function closeAccountPopup() {
      accountPopup.style.display = "none";
      accountButton.setAttribute("aria-expanded", "false");
    }
    function setActiveNav(section) {
      navLibrary.classList.remove("bg-blue-100", "text-blue-600", "font-bold");
      navRecentlyRead.classList.remove("bg-blue-100", "text-blue-600", "font-bold");
      if (section === "library") navLibrary.classList.add("bg-blue-100", "text-blue-600", "font-bold");
      else if (section === "recentlyRead") navRecentlyRead.classList.add("bg-blue-100", "text-blue-600", "font-bold");
    }
    function togglePlusMenu(e) {
      e.stopPropagation();
      if (plusMenuDropdown.classList.contains("hidden")) {
        plusMenuDropdown.classList.remove("hidden");
        plusMenuButton.setAttribute("aria-expanded", "true");
      } else closePlusMenu();
    }
    function closePlusMenu() {
      plusMenuDropdown.classList.add("hidden");
      plusMenuButton.setAttribute("aria-expanded", "false");
    }
    function closePlusMenuOnClickOutside(e) {
      if (!plusMenuButton.contains(e.target) && !plusMenuDropdown.contains(e.target)) closePlusMenu();
    }
    function openCreateFolderModal() {
      createFolderModal.classList.remove("hidden");
      folderNameInput.value = "";
      folderNameInput.focus();
    }
    function closeCreateFolderModal() {
      createFolderModal.classList.add("hidden");
    }
    function handleCreateFolder(e) {
      e.preventDefault();
      const name = folderNameInput.value.trim();
      if (!name) return;
      folders.push({ id: Date.now().toString(), name, ebooks: [] });
      renderLibraryItems();
      closeCreateFolderModal();
      showLibraryView();
      setActiveNav("library");
    }
    function renderLibraryItems() {
      if (folders.length === 0 && mainLibraryEbooks.length === 0) {
        libraryItemsContainer.innerHTML = `
          <div class="col-span-full bg-[#05346b] rounded-xl p-10 text-center text-[#f4a020] select-none flex flex-col items-center justify-center" style="height: 20rem;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="library" class="lucide lucide-library w-12 h-12 mb-3"><path d="M3 19a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z"></path><polyline points="3 7 12 13 21 7"></polyline></svg>
            <p class="text-lg font-semibold">Your library is empty.</p>
            <p class="text-sm mt-2">Click the + button to add folders or upload ebooks.</p>
          </div>`;
        return;
      }
      const folderHtml = folders.map(folder => `
        <div onclick="openFolder('${folder.id}')" class="relative group p-5 border border-[#f47920] transition cursor-pointer select-none rounded-xl hover:border-[#f4a020]">
          <div class="absolute top-3 right-3 flex space-x-1">
            <button onclick="event.stopPropagation(); openFolderRenameModal('${folder.id}')" class="opacity-0 group-hover:opacity-100 transition-opacity duration-150 p-1 rounded-md hover:bg-[#f47920] hover:text-white" aria-label="Rename folder ${folder.name}">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="edit-2" class="lucide lucide-edit-2 w-4 h-4"><path d="M17 3a2.828 2.828 0 0 1 4 4L7 21H3v-4L17 3z"></path></svg>
            </button>
            <button onclick="event.stopPropagation(); deleteFolder('${folder.id}')" class="opacity-0 group-hover:opacity-100 transition-opacity duration-150 p-1 rounded-md hover:bg-[#f47920] hover:text-white" aria-label="Delete folder ${folder.name}">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="trash-2" class="lucide lucide-trash-2 w-4 h-4"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6l-2 14H7L5 6"></path><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"></path></svg>
            </button>
          </div>
          <div class="flex items-center justify-center w-12 h-12 mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="folder" class="lucide lucide-folder w-6 h-6"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
          </div>
          <h3 class="text-base font-semibold truncate mb-1 group-hover:text-[#f4a020] transition-colors duration-150" title="${folder.name}">${folder.name}</h3>
          <div class="flex items-center text-xs text-[#f4a020] space-x-1">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="book" class="lucide lucide-book w-3 h-3"><path d="M4 19h16"></path><path d="M4 15h16"></path><path d="M4 11h16"></path><path d="M4 7h16"></path></svg>
            <span>${folder.ebooks.length} ${folder.ebooks.length === 1 ? "ebook" : "ebooks"}</span>
          </div>
          ${folder.ebooks.length > 0 ? `
            <div class="mt-3 flex -space-x-1">
              ${folder.ebooks.slice(0, 3).map((ebook, i) => ebook.coverImage ? `
                <img src="${ebook.coverImage}" alt="Cover image of the ebook titled ${ebook.title} in folder ${folder.name}" class="w-6 h-8 object-cover rounded border border-[#f47920] shadow-sm" style="z-index: ${3 - i}" />
              ` : `
                <div class="w-6 h-8 bg-[#05346b] rounded border border-[#f47920] shadow-sm flex items-center justify-center text-[#f4a020]" style="z-index: ${3 - i}">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="file-text" class="lucide lucide-file-text w-3 h-3"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                </div>
              `).join("")}
              ${folder.ebooks.length > 3 ? `<div class="w-6 h-8 bg-[#05346b] rounded border border-[#f47920] shadow-sm flex items-center justify-center text-[#f4a020] text-xs font-semibold">+${folder.ebooks.length - 3}</div>` : ""}
            </div>` : ""}
        </div>`).join("");
      const ebookHtml = mainLibraryEbooks.map(ebook => `
        <div class="group relative shadow-sm border border-[#f47920] hover:shadow-lg transition duration-150 select-none rounded-xl cursor-default" data-ebook-id="${ebook.id}" data-folder-id="main">
          <div class="absolute top-2 right-2 z-10">
            <button aria-haspopup="true" aria-expanded="false" aria-label="Open menu for ebook ${ebook.title}" class="menu-button p-1 rounded-md shadow-sm hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-offset-1 focus:ring-[#f47920]" onclick="toggleEbookMenu(event, '${ebook.id}', 'main')">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5" viewBox="0 0 24 24"><circle cx="12" cy="5" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="12" cy="19" r="1"/></svg>
            </button>
            <div class="popup-menu" id="menu-main-${ebook.id}" role="menu" aria-label="Menu for ebook ${ebook.title}">
              <button type="button" role="menuitem" onclick="openRenameModal('${ebook.id}', 'main')">Rename</button>
              <button type="button" role="menuitem" onclick="openDetailsModal('${ebook.id}', 'main')">Details</button>
              <button type="button" role="menuitem" onclick="deleteEbookById('${ebook.id}', 'main')">Delete</button>
            </div>
          </div>
          <div class="relative overflow-hidden rounded-t-xl">
            ${ebook.coverImage ? `
              <img src="${ebook.coverImage}" alt="Cover image of the ebook titled ${ebook.title}" class="w-full h-44 object-cover group-hover:scale-105 transition-transform duration-150 rounded-t-xl" />
              <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition duration-150 rounded-t-xl"></div>
            ` : `
              <div class="w-full h-44 bg-[#05346b] flex items-center justify-center rounded-t-xl">
                <div class="text-center text-[#f4a020]">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="file-text" class="lucide lucide-file-text w-10 h-10 mx-auto mb-1"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                  <span class="text-xs font-semibold">${ebook.fileType}</span>
                </div>
              </div>
            `}
          </div>
          <div class="p-3 space-y-1">
            <h3 class="font-semibold text-[#f4a020] truncate group-hover:text-white transition-colors duration-150" title="${ebook.title}">${ebook.title}</h3>
            <div class="flex items-center justify-between text-xs text-[#f4a020]">
              <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-[#f47920] text-white font-semibold">${ebook.fileType}</span>
              <span>Added ${formatDate(ebook.uploadedAt)}</span>
            </div>
          </div>
        </div>`).join("");
      libraryItemsContainer.innerHTML = folderHtml + ebookHtml;
      lucide.createIcons();
    }
    function renderEbooks() {
      if (!currentFolder || currentFolder.ebooks.length === 0) {
        ebooksContainer.innerHTML = `
          <div class="col-span-full bg-[#05346b] rounded-xl p-10 text-center text-[#f4a020] select-none flex flex-col items-center justify-center" style="height: 20rem;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="book" class="lucide lucide-book w-12 h-12 mb-3"><path d="M4 19h16"></path><path d="M4 15h16"></path><path d="M4 11h16"></path><path d="M4 7h16"></path></svg>
            <p class="text-lg font-semibold">This folder is empty.</p>
            <p class="text-sm mt-2">Upload ebooks using the + button above.</p>
          </div>`;
      } else {
        ebooksContainer.innerHTML = currentFolder.ebooks.map(ebook => `
          <div class="group relative shadow-sm border border-[#f47920] hover:shadow-lg transition duration-150 select-none rounded-xl cursor-default" data-ebook-id="${ebook.id}" data-folder-id="${currentFolder.id}">
            <div class="absolute top-2 right-2 z-10">
              <button aria-haspopup="true" aria-expanded="false" aria-label="Open menu for ebook ${ebook.title}" class="menu-button p-1 rounded-md shadow-sm hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-offset-1 focus:ring-[#f47920]" onclick="toggleEbookMenu(event, '${ebook.id}', '${currentFolder.id}')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5" viewBox="0 0 24 24"><circle cx="12" cy="5" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="12" cy="19" r="1"/></svg>
              </button>
              <div class="popup-menu" id="menu-${currentFolder.id}-${ebook.id}" role="menu" aria-label="Menu for ebook ${ebook.title}">
                <button type="button" role="menuitem" onclick="openRenameModal('${ebook.id}', '${currentFolder.id}')">Rename</button>
                <button type="button" role="menuitem" onclick="openDetailsModal('${ebook.id}', '${currentFolder.id}')">Details</button>
                <button type="button" role="menuitem" onclick="deleteEbookById('${ebook.id}', '${currentFolder.id}')">Delete</button>
              </div>
            </div>
            <div class="relative overflow-hidden rounded-t-xl">
              ${ebook.coverImage ? `
                <img src="${ebook.coverImage}" alt="Cover image of the ebook titled ${ebook.title}" class="w-full h-44 object-cover group-hover:scale-105 transition-transform duration-150 rounded-t-xl" />
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition duration-150 rounded-t-xl"></div>
              ` : `
                <div class="w-full h-44 bg-[#05346b] flex items-center justify-center rounded-t-xl">
                  <div class="text-center text-[#f4a020]">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="file-text" class="lucide lucide-file-text w-10 h-10 mx-auto mb-1"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                    <span class="text-xs font-semibold">${ebook.fileType}</span>
                  </div>
                </div>
              `}
            </div>
            <div class="p-3 space-y-1">
              <h3 class="font-semibold text-[#f4a020] truncate group-hover:text-white transition-colors duration-150" title="${ebook.title}">${ebook.title}</h3>
              <div class="flex items-center justify-between text-xs text-[#f4a020]">
                <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-[#f47920] text-white font-semibold">${ebook.fileType}</span>
                <span>Added ${formatDate(ebook.uploadedAt)}</span>
              </div>
            </div>
          </div>`).join("");
      }
      lucide.createIcons();
    }
    function deleteEbookById(ebookId, folderId) {
      let ebook = null;
      if (folderId === "main") ebook = mainLibraryEbooks.find(e => e.id === ebookId);
      else {
        const folder = folders.find(f => f.id === folderId);
        if (folder) ebook = folder.ebooks.find(e => e.id === ebookId);
      }
      if (ebook && confirm(`Are you sure you want to delete "${ebook.title}"?`)) {
        if (folderId === "main") mainLibraryEbooks = mainLibraryEbooks.filter(e => e.id !== ebookId);
        else {
          const folder = folders.find(f => f.id === folderId);
          if (folder) folder.ebooks = folder.ebooks.filter(e => e.id !== ebookId);
        }
        closeAllMenus();
        renderLibraryItems();
        renderRecentlyRead();
        if (currentFolder && currentFolder.id === folderId) renderEbooks();
      }
    }
    function deleteFolder(folderId) {
      const folder = folders.find(f => f.id === folderId);
      if (folder && confirm(`Are you sure you want to delete "${folder.name}" folder? This will also delete all ebooks inside it.`)) {
        folders = folders.filter(f => f.id !== folderId);
        renderLibraryItems();
        renderRecentlyRead();
        if (currentFolder && currentFolder.id === folderId) {
          showLibraryView();
          setActiveNav("library");
        }
      }
    }
    function openFolderRenameModal(folderId) {
      currentFolderToRename = folders.find(f => f.id === folderId);
      if (!currentFolderToRename) return;
      folderRenameInput.value = currentFolderToRename.name;
      folderRenameModal.classList.remove("hidden");
      folderRenameInput.focus();
    }
    function closeFolderRenameModal() {
      folderRenameModal.classList.add("hidden");
      currentFolderToRename = null;
    }
    function confirmFolderRename() {
      const newName = folderRenameInput.value.trim();
      if (!newName) return alert("Folder name cannot be empty.");
      if (currentFolderToRename) {
        currentFolderToRename.name = newName;
        renderLibraryItems();
        if (currentFolder && currentFolder.id === currentFolderToRename.id) folderTitle.textContent = newName;
      }
      closeFolderRenameModal();
    }
    function openFolder(folderId) {
      currentFolder = folders.find(f => f.id === folderId);
      if (currentFolder) {
        showFolderView();
        setActiveNav(null);
      }
    }
    function showFolderView() {
      librarySection.classList.add("hidden");
      folderViewSection.classList.remove("hidden");
      recentlyReadSection.classList.add("hidden");
      welcomeSection.classList.add("hidden");
      folderTitle.textContent = currentFolder.name;
      renderEbooks();
    }
    function showLibraryView() {
      folderViewSection.classList.add("hidden");
      librarySection.classList.remove("hidden");
      recentlyReadSection.classList.add("hidden");
      welcomeSection.classList.add("hidden");
      currentFolder = null;
      closeUploadModal();
      renderLibraryItems();
    }
    function showRecentlyReadView() {
      folderViewSection.classList.add("hidden");
      librarySection.classList.add("hidden");
      recentlyReadSection.classList.remove("hidden");
      welcomeSection.classList.remove("hidden");
      currentFolder = null;
      closeUploadModal();
    }
    function openUploadModal() {
      uploadModal.classList.remove("hidden");
      uploadModalTitle.value = "";
      uploadModalFile.value = "";
      uploadModalCover.value = "";
      resetUploadModalCoverPreview();
      uploadModalTitleError.classList.add("hidden");
      uploadModalFileError.classList.add("hidden");
      uploadModalTitle.focus();
    }
    function closeUploadModal() {
      uploadModal.classList.add("hidden");
      uploadModalForm.reset();
      resetUploadModalCoverPreview();
      uploadModalTitleError.classList.add("hidden");
      uploadModalFileError.classList.add("hidden");
    }
    async function handleUploadModalSubmit(e) {
      e.preventDefault();
      const title = uploadModalTitle.value.trim();
      const fileInput = uploadModalFile.files[0];
      let valid = true;
      if (!title) { uploadModalTitleError.classList.remove("hidden"); valid = false; } else uploadModalTitleError.classList.add("hidden");
      if (!fileInput) { uploadModalFileError.classList.remove("hidden"); valid = false; } else uploadModalFileError.classList.add("hidden");
      if (!valid) return;
      alert("Ebook uploaded successfully! Implement actual upload logic.");
      closeUploadModal();
    }
    function handleUploadModalCoverChange(e) {
      const file = e.target.files[0];
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = function (ev) { showUploadModalCoverPreview(ev.target.result); };
        reader.readAsDataURL(file);
      } else resetUploadModalCoverPreview();
    }
    function showUploadModalCoverPreview(src) {
      uploadModalCoverPreview.innerHTML = `
        <img src="${src}" alt="Cover preview of the selected ebook cover image" class="w-full h-full object-cover rounded-xl" />
        <button type="button" onclick="removeUploadModalCover()" class="absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 hover:bg-red-700 transition-colors duration-150" aria-label="Remove cover image">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x w-3 h-3"><line x1="18" x2="6" y1="6" y2="18"></line><line x1="6" x2="18" y1="6" y2="18"></line></svg>
        </button>`;
      lucide.createIcons();
    }
    function resetUploadModalCoverPreview() {
      uploadModalCoverPreview.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="image" class="lucide lucide-image w-7 h-7 mb-1"><rect height="14" rx="2" ry="2" width="18" x="3" y="3"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
        <span class="text-xs text-center px-2 text-[#f4a020] select-none">No cover selected</span>`;
      lucide.createIcons();
    }
    function removeUploadModalCover() {
      uploadModalCover.value = "";
      resetUploadModalCoverPreview();
    }
    function formatDate(date) {
      return new Date(date).toLocaleDateString("en-US", { month: "short", day: "numeric", hour: "2-digit", minute: "2-digit" });
    }
    function toggleEbookMenu(e, ebookId, folderId) {
      e.stopPropagation();
      closeAllMenus();
      const menu = document.getElementById(`menu-${folderId}-${ebookId}`);
      if (menu) {
        menu.style.display = "flex";
        e.currentTarget.setAttribute("aria-expanded", "true");
      }
    }
    function closeAllMenus() {
      document.querySelectorAll(".popup-menu").forEach(menu => {
        menu.style.display = "none";
        const btn = menu.previousElementSibling;
        if (btn && btn.getAttribute("aria-expanded") === "true") btn.setAttribute("aria-expanded", "false");
      });
    }
    function openRenameModal(ebookId, folderId) {
      closeAllMenus();
      currentEbookFolder = folderId === "main" ? null : folders.find(f => f.id === folderId);
      currentEbook = folderId === "main" ? mainLibraryEbooks.find(e => e.id === ebookId) : currentEbookFolder ? currentEbookFolder.ebooks.find(e => e.id === ebookId) : null;
      if (!currentEbook) return;
      renameInput.value = currentEbook.title;
      renameModal.classList.remove("hidden");
      renameInput.focus();
    }
    function closeRenameModal() {
      renameModal.classList.add("hidden");
      currentEbook = null;
      currentEbookFolder = null;
    }
    function confirmRename() {
      const newName = renameInput.value.trim();
      if (!newName) return alert("Name cannot be empty.");
      if (currentEbook) {
        currentEbook.title = newName;
        renderLibraryItems();
        if (currentFolder) renderEbooks();
        renderRecentlyRead();
      }
      closeRenameModal();
    }
    function openDetailsModal(ebookId, folderId) {
      closeAllMenus();
      let ebook = null;
      if (folderId === "main") ebook = mainLibraryEbooks.find(e => e.id === ebookId);
      else {
        const folder = folders.find(f => f.id === folderId);
        if (folder) ebook = folder.ebooks.find(e => e.id === ebookId);
      }
      if (!ebook) return;
      const sizeStr = ebook.size ? formatBytes(ebook.size) : "Unknown";
      const uploadedStr = ebook.uploadedAt ? formatDate(ebook.uploadedAt) : "Unknown";
      detailsContent.innerHTML = `
        <p><strong>Name:</strong> ${escapeHtml(ebook.title)}</p>
        <p><strong>Size:</strong> ${sizeStr}</p>
        <p><strong>Date Uploaded:</strong> ${uploadedStr}</p>`;
      detailsModal.classList.remove("hidden");
    }
    function closeDetailsModal() {
      detailsModal.classList.add("hidden");
      detailsContent.innerHTML = "";
    }
    function formatBytes(bytes) {
      if (bytes === 0) return "0 Bytes";
      const k = 1024, sizes = ["Bytes", "KB", "MB", "GB", "TB"];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
    }
    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[m]);
    }
    function renderRecentlyRead() {
      const recentlyRead = [];
      folders.forEach(folder => folder.ebooks.forEach(ebook => { if (ebook.lastRead) recentlyRead.push(ebook); }));
      mainLibraryEbooks.forEach(ebook => { if (ebook.lastRead) recentlyRead.push(ebook); });
      recentlyRead.sort((a, b) => new Date(b.lastRead) - new Date(a.lastRead));
      if (recentlyRead.length === 0) {
        recentlyReadContainer.innerHTML = `
          <div class="col-span-full bg-[#05346b] rounded-xl p-8 text-center text-[#f4a020] select-none flex flex-col items-center justify-center" style="height: 20rem;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#f4a020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="book" class="lucide lucide-book w-10 h-10 mb-3"><path d="M4 19h16"></path><path d="M4 15h16"></path><path d="M4 11h16"></path><path d="M4 7h16"></path></svg>
            <p class="text-lg font-semibold">No recent ebooks yet.</p>
            <p class="text-sm mt-2">Start reading to see them here!</p>
          </div>`;
      } else {
        recentlyReadContainer.innerHTML = recentlyRead.map(ebook => `
          <div class="group cursor-pointer transform transition duration-150 hover:scale-105 rounded-xl select-none" tabindex="0" role="button" aria-label="Recently read ebook titled ${ebook.title}">
            <div class="relative rounded-xl overflow-hidden">
              ${ebook.coverImage ? `
                <img src="${ebook.coverImage}" alt="Cover image of the recently read ebook titled ${ebook.title}" class="w-full h-36 object-cover rounded-xl shadow-sm group-hover:shadow-lg transition-shadow duration-150" />
              ` : `
                <div class="w-full h-36 bg-[#05346b] rounded-xl shadow-sm flex items-center justify-center text-[#f4a020]">
                  <img src="https://placehold.co/80x120?text=No+Cover+Image" alt="Placeholder image for ebook with no cover" class="w-20 h-30 object-contain" />
                </div>
              `}
              <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 rounded-xl transition duration-150 flex items-center justify-center">
                <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-150">
                  <div class="bg-[#f47920] rounded-full p-2 shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="53, 46, 189" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="book" class="lucide lucide-book w-5 h-5"><path d="M4 19h16"></path><path d="M4 15h16"></path><path d="M4 11h16"></path><path d="M4 7h16"></path></svg>
                  </div>
                </div>
              </div>
            </div>
            <div class="mt-2 space-y-0.5">
              <h3 class="font-semibold text-[#f4a020] truncate group-hover:text-white transition-colors duration-150" title="${ebook.title}">${ebook.title}</h3>
              <div class="flex items-center justify-between text-xs text-[#f4a020]">
                <span class="bg-[#f47920] px-2 py-0.5 rounded-full font-semibold text-white">${ebook.fileType}</span>
                <span>${formatDate(ebook.lastRead)}</span>
              </div>
            </div>
          </div>`).join("");
      }
      lucide.createIcons();
    }
    function init() {
      renderLibraryItems();
      renderRecentlyRead();
      showRecentlyReadView();
      setActiveNav("recentlyRead");
      lucide.createIcons();
    }
    init();
    window.openFolder = openFolder;
    window.deleteFolder = deleteFolder;
    window.openFolderRenameModal = openFolderRenameModal;
    window.deleteEbook = deleteEbookById;
    window.openCreateFolderModal = openCreateFolderModal;
    window.toggleEbookMenu = toggleEbookMenu;
    window.openRenameModal = openRenameModal;
    window.openDetailsModal = openDetailsModal;

    let userEmail = 'john.doe@example.com';
    let isPremium = false;
    let maxStorage = 500 * 1024 * 1024;

    function updateAccountUI() {
      document.getElementById('accountEmail').textContent = userEmail;
      document.getElementById('userMenuButton').textContent = userEmail;
      document.querySelector('#accountPopup .storage').textContent = `${formatBytes(getUsedStorage())} of ${formatBytes(maxStorage)} used`;
      document.getElementById('goPremiumBtn').style.display = isPremium ? 'none' : '';
    }
    function getUsedStorage() {
      let used = 0;
      folders.forEach(f => f.ebooks.forEach(e => used += e.size || 0));
      mainLibraryEbooks.forEach(e => used += e.size || 0);
      return used;
    }
    logoutBtn.addEventListener("click", () => { window.location.href = "signup.html"; });
    window.addEventListener('DOMContentLoaded', updateAccountUI);
  </script>
</body>
</html>